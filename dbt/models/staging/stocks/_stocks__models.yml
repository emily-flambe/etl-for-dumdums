version: 2

models:
  - name: stg_stocks__prices
    description: Staged daily stock prices with renamed columns
    config:
      schema: stocks
      tags: ['stocks']
    columns:
      - name: price_id
        description: Unique price record identifier (ticker_date)
        tests:
          - unique
          - not_null
      - name: ticker
        description: Stock ticker symbol (e.g., AAPL, MSFT)
        tests:
          - not_null
          - accepted_values:
              values: ['AAPL', 'MSFT', 'NVDA', 'GOOGL', 'META', 'AMD', 'CRM', 'JNJ', 'UNH', 'PFE', 'ABBV', 'MRK', 'LLY', 'XOM', 'CVX', 'COP', 'SLB', 'OXY', 'NEE', 'CAT', 'HON', 'BA', 'UPS', 'GE', 'DE', 'AMZN', 'WMT', 'COST', 'HD', 'NKE', 'SBUX', 'TGT']
      - name: sector
        description: Industry sector (Technology, Healthcare, Energy, Industrial, Consumer Retail)
        tests:
          - accepted_values:
              values: ['Technology', 'Healthcare', 'Energy', 'Industrial', 'Consumer Retail']
      - name: trade_date
        description: Trading date
        tests:
          - not_null
      - name: open_price
        description: Opening price for the day
        tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"
              config:
                where: "open_price is not null"
      - name: high_price
        description: Highest price during the day
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= low_price"
              config:
                where: "high_price is not null and low_price is not null"
          - dbt_utils.expression_is_true:
              expression: ">= close_price"
              config:
                where: "high_price is not null and close_price is not null"
      - name: low_price
        description: Lowest price during the day
        tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"
              config:
                where: "low_price is not null"
          - dbt_utils.expression_is_true:
              expression: "<= close_price"
              config:
                where: "low_price is not null and close_price is not null"
      - name: close_price
        description: Closing price for the day
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "> 0"
      - name: adj_close_price
        description: Adjusted closing price (accounts for splits and dividends)
      - name: volume
        description: Number of shares traded
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              config:
                where: "volume is not null"
      - name: fetched_at
        description: Timestamp when data was fetched from Yahoo Finance
