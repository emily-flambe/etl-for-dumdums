version: 2

models:
  - name: stg_linear__issues
    description: Staged Linear issues with cleaned column names
    config:
      schema: linear
      tags: ['linear']
    columns:
      - name: issue_id
        description: Unique issue identifier
        tests:
          - unique
          - not_null
      - name: identifier
        description: Human-readable issue ID (e.g., ENG-123)
        tests:
          - not_null
      - name: state
        description: Issue state
        tests:
          - accepted_values:
              values: ['Backlog', 'Todo', 'In Progress', 'In Review', 'Done', 'Cancelled']
      - name: priority
        description: Priority level (0=none, 1=urgent, 2=high, 3=normal, 4=low)
        tests:
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: assignee_id
        description: FK to stg_linear__users
        tests:
          - relationships:
              to: ref('stg_linear__users')
              field: user_id
              config:
                where: "assignee_id is not null"
      - name: cycle_id
        description: FK to stg_linear__cycles
        tests:
          - relationships:
              to: ref('stg_linear__cycles')
              field: cycle_id
              config:
                where: "cycle_id is not null"

  - name: stg_linear__users
    description: Staged Linear users
    config:
      schema: linear
      tags: ['linear']
    columns:
      - name: user_id
        description: Unique user identifier
        tests:
          - unique
          - not_null
      - name: email
        description: User email (cross-platform join key)
        tests:
          - unique
          - not_null

  - name: stg_linear__cycles
    description: Staged Linear cycles/sprints
    config:
      schema: linear
      tags: ['linear']
    columns:
      - name: cycle_id
        description: Unique cycle identifier
        tests:
          - unique
          - not_null
      - name: starts_at
        description: Cycle start date
        tests:
          - not_null
      - name: ends_at
        description: Cycle end date
        tests:
          - not_null
