version: 2

models:
  - name: fct_hn_weekly_stats
    description: Weekly aggregate statistics for Hacker News activity
    config:
      schema: hacker_news
      tags: ['hacker_news']
    columns:
      - name: week
        description: Week start date (Monday)
        tests:
          - unique
          - not_null
      - name: story_count
        description: Number of stories posted
        tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"
      - name: total_score
        description: Sum of all story scores
      - name: avg_score
        description: Average story score
      - name: total_comments
        description: Sum of all comments
      - name: avg_comments
        description: Average comments per story
      - name: unique_authors
        description: Number of distinct authors

  - name: fct_hn_domain_stats
    description: Weekly domain popularity statistics
    config:
      schema: hacker_news
      tags: ['hacker_news']
    columns:
      - name: week
        description: Week start date (Monday)
        tests:
          - not_null
      - name: domain
        description: Website domain
        tests:
          - not_null
      - name: story_count
        description: Number of stories from this domain
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 3"
      - name: total_score
        description: Sum of scores for stories from this domain
      - name: avg_score
        description: Average score for stories from this domain

  - name: fct_hn_keyword_trends
    description: Weekly keyword mention trends in story titles
    config:
      schema: hacker_news
      tags: ['hacker_news']
    columns:
      - name: week
        description: Week start date (Monday)
        tests:
          - not_null
      - name: keyword
        description: Technology keyword tracked (defined in SQL model)
        tests:
          - not_null
      - name: mention_count
        description: Number of stories mentioning this keyword
        tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"
      - name: total_score
        description: Sum of scores for stories mentioning this keyword
      - name: avg_score
        description: Average score for stories mentioning this keyword

  - name: fct_hn_keyword_sentiment
    description: Daily sentiment aggregates by keyword from comment analysis
    config:
      schema: hacker_news
      tags: ['hacker_news']
    columns:
      - name: keyword
        description: Technology keyword tracked
        tests:
          - not_null
      - name: day
        description: Day of aggregation
        tests:
          - not_null
      - name: comment_count
        description: Number of comments analyzed
        tests:
          - dbt_utils.expression_is_true:
              expression: "> 0"
      - name: story_count
        description: Number of distinct stories
      - name: avg_sentiment
        description: Average sentiment score (-1 to 1)
        tests:
          - dbt_utils.accepted_range:
              min_value: -1
              max_value: 1
              inclusive: true
              config:
                where: "avg_sentiment is not null"
      - name: sentiment_stddev
        description: Standard deviation of sentiment scores
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              config:
                where: "sentiment_stddev is not null"
      - name: avg_magnitude
        description: Average sentiment magnitude (strength)
      - name: positive_pct
        description: Percentage of comments with positive sentiment
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
              inclusive: true
      - name: negative_pct
        description: Percentage of comments with negative sentiment
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
              inclusive: true
      - name: neutral_pct
        description: Percentage of comments with neutral sentiment
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 100
              inclusive: true
      - name: min_sentiment
        description: Minimum sentiment score for the day
      - name: max_sentiment
        description: Maximum sentiment score for the day
      - name: sentiment_dod_change
        description: Day-over-day change in average sentiment
      - name: positive_pct_dod_change
        description: Day-over-day change in positive percentage
