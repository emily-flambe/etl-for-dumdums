version: 2

models:
  - name: fct_pull_requests
    description: |
      Fact table of GitHub pull requests enriched with author details,
      review statistics, and derived metrics like cycle time.
    config:
      schema: github
      tags: ['github']
    columns:
      - name: pull_request_id
        description: Unique pull request identifier
        tests:
          - unique
          - not_null
      - name: pr_number
        description: PR number within repo (e.g., #123)
      - name: author_email
        description: Email of PR author (cross-platform join key)
      - name: cycle_time_hours
        description: Hours from PR open to merge
      - name: time_to_first_review_hours
        description: Hours from PR open to first review
      - name: additions
        description: Lines added
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              config:
                where: "additions is not null"
      - name: deletions
        description: Lines deleted
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              config:
                where: "deletions is not null"
      - name: review_count
        description: Total number of reviews
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
              config:
                where: "review_count is not null"
      - name: approval_count
        description: Number of approvals
        tests:
          - dbt_utils.expression_is_true:
              expression: "<= review_count"
              config:
                where: "approval_count is not null and review_count is not null"

  - name: fct_reviewer_activity
    description: |
      Reviewer activity metrics showing response times for reviews and comments
      per PR participant. Used for measuring review responsiveness by team member.
      Excludes PR authors reviewing their own PRs.
    config:
      schema: github
      tags: ['github']
    columns:
      - name: reviewer_id
        description: GitHub user ID of the reviewer/commenter
        tests:
          - not_null
      - name: pull_request_id
        description: FK to fct_pull_requests
        tests:
          - not_null
      - name: reviewer_username
        description: GitHub username of the reviewer
      - name: pr_repo
        description: Repository name
      - name: pr_created_at
        description: When the PR was opened
      - name: time_to_first_review_hours
        description: Hours from PR open to this reviewer's first review
      - name: time_to_first_comment_hours
        description: Hours from PR open to this reviewer's first comment
      - name: time_to_first_response_hours
        description: Hours from PR open to first activity (review or comment)
